---
import BaseLayout from '../../layouts/BaseLayout.astro';
import CardTable from '../../components/cards/CardTable';
import type { CardsData } from '../../types/card';

// Import cards data at build time to get dynamic card count
import cardsDataRaw from '../../data/cards.json';
const cardsData = cardsDataRaw as unknown as CardsData;
const cardCount = Object.keys(cardsData.cards).length;

const currentLocale = 'en';

// SEO: Optimized title and description with LSI keywords
// Primary: daemon, database | LSI: character, unit, spirit, guide, wiki, mobile RPG
// Title limit: 60 chars (+ " | OtogiDB" = 70 max), Description limit: 160 chars
const pageTitle = "Otogi: Spirit Agents Database - Stats & Skills";
const pageDescription = `Complete Otogi: Spirit Agents guide with ${cardCount} daemons. Browse stats, skills, and abilities. Filter by attribute, type, and rarity.`;

// JSON-LD WebSite structured data with search action
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "OtogiDB - Otogi: Spirit Agents Database",
  "alternateName": ["OtogiDB", "Otogi Database", "Otogi Wiki", "Otogi Spirit Agents Guide"],
  "url": "https://otogidb.com/en",
  "inLanguage": "en",
  "description": pageDescription,
  "keywords": "Otogi Spirit Agents, daemon database, character guide, mobile RPG wiki, gacha game, spirits, skills, abilities",
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "https://otogidb.com/en/?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
};
---

<BaseLayout title={pageTitle} description={pageDescription} lang={currentLocale}>
  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

  <div class="container mx-auto px-4 py-6">
    <div class="mb-4 md:mb-6">
      <h1 class="text-lg sm:text-xl md:text-3xl font-bold mb-1 md:mb-2">Otogi: Spirit Agents Database</h1>
      <p class="text-secondary text-sm md:text-base hidden sm:block">Browse all {cardCount} characters with complete stats, skills, and abilities. Filter by attribute, type, or rarity.</p>
    </div>

    <!-- Card Table (React Island) -->
    <div class="card p-4">
      <CardTable client:visible />
    </div>
  </div>
</BaseLayout>
